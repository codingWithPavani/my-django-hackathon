{% extends 'attendance/base.html' %}
{% block content %}
<h1>Teacher Dashboard</h1>

<div class="row">
  <!-- Save Attendance (single entry) -->
  <div class="col-md-6">
    <div class="card mb-3 p-3">
      <h5>Save Attendance</h5>

      {% if next_student %}
        <form method="post" action="{% url 'save_attendance' %}">
          {% csrf_token %}
          <div class="mb-2">
            <label class="form-label">Roll Number</label>
            <input class="form-control" name="roll_number" value="{{ next_student.roll_number }}" readonly>
          </div>
          <div class="mb-2">
            <label class="form-label">Status</label>
            <select name="attendance" class="form-select">
              <option value="Present">Present</option>
              <option value="Absent">Absent</option>
            </select>
          </div>
          <button class="btn btn-primary" type="submit">Save Attendance</button>
        </form>
      {% else %}
        <div class="alert alert-success mb-0">
          ✅ Attendance completed for all students today!
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Save Grade (step-by-step) -->
  <div class="col-md-6">
    <div class="card mb-3 p-3">
      <h5>Save Grade</h5>

      {% if current_student_roll and next_subject %}
        <form method="post" action="{% url 'save_grade' %}">
          {% csrf_token %}
          <div class="mb-2">
            <label class="form-label">Roll Number</label>
            <input class="form-control" name="roll_number" value="{{ current_student_roll }}" readonly>
          </div>
          <div class="mb-2">
            <label class="form-label">Subject</label>
            <input class="form-control" name="subject" value="{{ next_subject }}" readonly>
          </div>
          <div class="mb-2">
            <label class="form-label">Marks</label>
            <input type="number" class="form-control" name="marks" required>
          </div>
          <button class="btn btn-success" type="submit">Save Grade</button>
        </form>
      {% else %}
        <div class="alert alert-success mb-0">
          ✅ All grades completed for all students!
        </div>
      {% endif %}
    </div>
  </div>
</div>

<hr>

<h4>Students (Latest Attendance & Total Grade)</h4>
<table class="table table-bordered table-striped">
  <thead class="table-light">
    <tr>
      <th>Roll</th>
      <th>Name</th>
      <th>Latest Attendance</th>
      <th>Total Grade</th>
    </tr>
  </thead>
  <tbody>
    {% for s in students %}
      <tr>
        <td>{{ s.roll_number }}</td>
        <td>{{ s.user.get_full_name|default:s.user.username }}</td>
        <td>{{ s.attendance_status }}</td>
        <td>
          {% if s.grade_value != "N/A" %}
            <span class="
              {% if s.grade_value == 'S' %}text-success fw-bold{% endif %}
              {% if s.grade_value == 'A' %}text-success fw-bold{% endif %}
              {% if s.grade_value == 'B' %}text-primary fw-bold{% endif %}
              {% if s.grade_value == 'C' %}text-warning fw-bold{% endif %}
              {% if s.grade_value == 'D' %}text-orange fw-bold{% endif %}
              {% if s.grade_value == 'E' %}text-info fw-bold{% endif %}
              {% if s.grade_value == 'F' %}text-danger fw-bold{% endif %}
            ">
              {{ s.grade_value }}
            </span>
          {% else %}
            <span class="text-muted">No grades yet</span>
          {% endif %}
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="4" class="text-center">No students yet</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
